
<h1><%= title %></h1>

<div id="user-welcome" style="display: none;">Welcome, <span id="user">N/A</span></div>

<br/>

<form>
  <div class="form-group">
    <input type="email" class="form-control" id="email" placeholder="Email">
  </div>
  
  <div class="form-group">
    <input type="password" class="form-control" id="password" placeholder="Password">
  </div>
  
  <div id="display-name-field" style="display: none;">
    <div id="display-name-text" style="font-size: 16px; padding-top: 10px; padding-bottom: 10px; padding-left: 12px;">(None)</div>
    <input style="display: none;" type="text" class="form-control" id="display-name-input" placeholder="Display name">
  </div>
  
  <br/>
  
  <button id="signup" type="button" class="btn btn-primary">Sign-up</button>
  <button id="login" type="button" class="btn btn-success">Login</button>
  <button id="logout" type="button" class="btn btn-danger">Logout</button>
</form>

<script>
  var socket = io.connect(window.location.host);
  
  socket.on('sign-up-failure', data => alert('Sign up failed, ' + JSON.parse(data).message));
  socket.on('log-in-failure', data => alert('Log in failed, ' + JSON.parse(data).message));
  socket.on('log-out-failure', data => alert('Log out failed, ' + JSON.parse(data).message));

  $(document).ready(() => {
    $('#display-name-text').click(e => {
      $('#display-name-text').hide(0, e => {
        $('#display-name-input').focusout(e => {
          $('#display-name-input').hide(0, e => $('#display-name-text').show());
        });
        
        $('#display-name-input').show();
        $('#display-name-input').focus();
      });
    });
    
    socket.on('auth-state-changed', data => {
      var user = JSON.parse(data);
      
      if (user) {
        $('#user').text(user.email);
        $('#user-welcome').show();
        $('#display-name-field').show();
      }
      else
        $('#user-welcome').hide();
    });
    
    $('#signup').click(e => {
      var email = $('#email').val();
      var password = $('#password').val();

      socket.emit('sign-up-request', JSON.stringify({
        email: email,
        password: password
      }));
    });
    
    $('#login').click(e => {
      var email = $('#email').val();
      var password = $('#password').val();

      socket.emit('log-in-request', JSON.stringify({
        email: email,
        password: password
      }));
    });
    
    $('#logout').click(e => socket.emit('log-out-request'));
  });
</script>
